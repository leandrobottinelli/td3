     1                                  GLOBAL isr0_handler_DE
     2                                  GLOBAL isr2_handler_NMI
     3                                  GLOBAL isr3_handler_BP
     4                                  GLOBAL isr4_handler_OF
     5                                  GLOBAL isr5_handler_BR
     6                                  GLOBAL isr6_handler_UD
     7                                  GLOBAL isr7_handler_NM
     8                                  GLOBAL isr8_handler_DF
     9                                  GLOBAL isr9_handler
    10                                  GLOBAL isr10_handler_TS
    11                                  GLOBAL isr11_handler_NP
    12                                  GLOBAL isr12_handler_SS
    13                                  GLOBAL isr13_handler_GP
    14                                  GLOBAL isr14_handler_PF
    15                                  GLOBAL isr15_handler
    16                                  GLOBAL isr16_handler_MF
    17                                  GLOBAL isr17_handler_AC
    18                                  GLOBAL isr18_handler_MC
    19                                  GLOBAL isr19_handler_XF
    20                                  GLOBAL isr32_handler
    21                                  GLOBAL isr33_handler
    22                                  
    23                                  
    24                                  
    25                                  ;GLOBAL POLLING
    26                                  GLOBAL LECTURA_TECLA
    27                                  EXTERN FIN
    28                                  EXTERN __INICIO_RAM_TECLADO_RUTINA
    29                                  EXTERN _flag_int_teclado
    30                                  
    31                                  
    32                                  %define _PUERTO_TECLADO  0x64;
    33                                  %define _PUERTO_TECLADO_CODIGO 0x60;
    34                                  ;-------------------------------------------------------------------------------
    35                                  
    36                                  section .rutina_teclado_isr
    37                                  USE32
    38                                  
    39                                  POLLING:
    40                                  
    41 00000000 E464                    in al, _PUERTO_TECLADO 
    42 00000002 0FBAE000                bt eax, 0x00
    43 00000006 73F8                    jnc POLLING
    44                                  
    45                                  LECTURA_TECLA:
    46                                  
    47 00000008 E460                    in al, _PUERTO_TECLADO_CODIGO
    48 0000000A 660FBAE007              bt ax, 0x7                       ;Me fijo si la tecla fue presionada o soltada
    49 0000000F 72EF                    jc POLLING                       ;Me quedo solo con la tecla persionada
    50                                  
    51                                  ;xchg bx,bx
    52 00000011 C3                      ret
    53                                  
    54                                  
    55                                  ;jmp CARGADO_TABLA
    56                                  
    57                                  
    58                                  ;CARGADO_TABLA:
    59                                  
    60                                  ;push ax
    61                                  ;call CARGAR_TABLA
    62                                  ;pop ax
    63                                  ;ret
    64                                  
    65                                  
    66                                  ;---------------------------------------------------------------------
    67                                  ; Handlers ISRs
    68                                  
    69                                  default_isr:
    70 00000012 90                         nop
    71 00000013 6687DB                     xchg bx,bx
    72 00000016 90                         nop
    73 00000017 F4                         hlt
    74                                  
    75                                  
    76                                  isr0_handler_DE:
    77 00000018 BA00000000                 mov edx, 0
    78 0000001D EBF3                       jmp default_isr
    79                                  
    80                                  
    81                                  isr2_handler_NMI:
    82 0000001F BA02000000                 mov edx, 2
    83 00000024 EBEC                       jmp default_isr
    84                                  
    85                                  
    86                                  isr3_handler_BP:
    87 00000026 BA03000000                 mov edx, 3
    88 0000002B EBE5                       jmp default_isr
    89                                  
    90                                  
    91                                  isr4_handler_OF:
    92 0000002D BA04000000                 mov edx, 4
    93 00000032 EBDE                       jmp default_isr
    94                                  
    95                                  
    96                                  isr5_handler_BR:
    97 00000034 BA05000000                 mov edx, 5
    98 00000039 EBD7                       jmp default_isr
    99                                  
   100                                  
   101                                  isr6_handler_UD:
   102 0000003B BA06000000                 mov edx, 6
   103 00000040 EBD0                       jmp default_isr
   104                                  
   105                                  
   106                                  isr7_handler_NM:
   107 00000042 BA07000000                 mov edx, 7
   108 00000047 EBC9                       jmp default_isr
   109                                  
   110                                  
   111                                  isr8_handler_DF:
   112 00000049 BA08000000                 mov edx, 8
   113 0000004E EBC2                       jmp default_isr
   114                                  
   115                                  isr9_handler:
   116 00000050 BA09000000                 mov edx, 9
   117 00000055 EBBB                       jmp default_isr
   118                                  
   119                                  
   120                                  isr10_handler_TS:
   121 00000057 BA0A000000                 mov edx, 10
   122 0000005C EBB4                       jmp default_isr
   123                                  
   124                                  
   125                                  isr11_handler_NP:
   126 0000005E BA0B000000                 mov edx, 11
   127 00000063 EBAD                       jmp default_isr
   128                                  
   129                                  
   130                                  isr12_handler_SS:
   131 00000065 BA0C000000                 mov edx, 12
   132 0000006A EBA6                       jmp default_isr
   133                                  
   134                                  
   135                                  isr13_handler_GP:
   136 0000006C BA0D000000                 mov edx, 13
   137 00000071 EB9F                       jmp default_isr
   138                                  
   139                                  
   140                                  isr14_handler_PF:
   141 00000073 BA0E000000                 mov edx, 14
   142 00000078 EB98                       jmp default_isr
   143                                  
   144                                  isr15_handler:
   145 0000007A BA0F000000                 mov edx, 15
   146 0000007F EB91                       jmp default_isr
   147                                  
   148                                  isr16_handler_MF:
   149 00000081 BA10000000                 mov edx, 16
   150 00000086 EB8A                       jmp default_isr
   151                                  
   152                                  
   153                                  isr17_handler_AC:
   154 00000088 BA11000000                 mov edx, 17
   155 0000008D EB83                       jmp default_isr
   156                                  
   157                                  
   158                                  isr18_handler_MC:
   159 0000008F BA12000000                 mov edx, 18
   160 00000094 E979FFFFFF                 jmp default_isr
   161                                  
   162                                  
   163                                  isr19_handler_XF:
   164 00000099 BA13000000                 mov edx, 19
   165 0000009E E96FFFFFFF                 jmp default_isr
   166                                  
   167                                  
   168                                  isr32_handler:
   169 000000A3 BA20000000                 mov edx, 32
   170 000000A8 E965FFFFFF                 jmp default_isr
   171                                  
   172                                  isr33_handler:
   173                                  
   174                                     ;xchg bx,bx
   175 000000AD 60                         pushad
   176 000000AE 66B80100                   mov ax, 0x1
   177 000000B2 66A3[00000000]             mov [_flag_int_teclado],ax
   178 000000B8 B020                       mov al,0x20       ;Codigo para avisar al PIC que atendi la int 
   179 000000BA E620                       out 0x20,al
   180 000000BC 61                         popad
   181 000000BD CF                         iret
   182                                  
   183                                  
   184                                  
   185                                  
   186                                  
   187                                  
   188                                  
   189                                  
   190                                  
   191                                  
   192                                  
   193                                  
   194                                  
   195                                  
   196                                  
   197                                  
   198                                  
   199                                  
   200                                  
   201                                  
   202                                  
   203                                  

     1                                  
     2                                  
     3                                  GLOBAL img_gdtr_32
     4                                  GLOBAL img_idtr
     5                                  
     6                                  GLOBAL cs_sel_32
     7                                  GLOBAL ds_sel_32
     8                                  
     9                                  
    10                                  EXTERN isr0_handler_DE
    11                                  EXTERN isr2_handler_NMI
    12                                  EXTERN isr3_handler_BP
    13                                  EXTERN isr4_handler_OF
    14                                  EXTERN isr5_handler_BR
    15                                  EXTERN isr6_handler_UD
    16                                  EXTERN isr7_handler_NM
    17                                  EXTERN isr8_handler_DF
    18                                  EXTERN isr9_handler
    19                                  EXTERN isr10_handler_TS
    20                                  EXTERN isr11_handler_NP
    21                                  EXTERN isr12_handler_SS
    22                                  EXTERN isr13_handler_GP
    23                                  EXTERN isr14_handler_PF
    24                                  EXTERN isr15_handler
    25                                  EXTERN isr16_handler_MF
    26                                  EXTERN isr17_handler_AC
    27                                  EXTERN isr18_handler_MC
    28                                  EXTERN isr19_handler_XF
    29                                  EXTERN isr20_31_handler
    30                                  EXTERN isr32_handler_PIT
    31                                  EXTERN isr33_handler_KEYBOARD
    32                                  
    33                                  
    34                                  section .sys_tables
    35                                  
    36                                  USE16
    37                                  
    38                                  gdt_32:
    39 00000000 0000000000000000                  db 0,0,0,0,0,0,0,0  ;Descriptor nulo
    40                                  ds_sel_32 equ $-gdt_32
    41 00000008 FFFF00000092CF00                  db 0xFF, 0xFF, 0, 0, 0, 0x92, 0xCF, 0
    42                                  cs_sel_32    equ $-gdt_32
    43 00000010 FFFF0000009ACF00                  db 0xFF, 0xFF, 0, 0, 0, 0x9A, 0xCF, 0
    44                                  
    45                                  long_gdt_32 equ $-gdt_32
    46                                  
    47                                  
    48                                  img_gdtr_32:
    49 00000018 1700                        dw long_gdt_32-1
    50 0000001A [00000000]                  dd gdt_32
    51                                  
    52                                  
    53                                  ;--------------------------------------------------------------------------------------
    54                                  ;   uint16_t offset_1; // offset bits 0..15
    55                                  ;   uint16_t selector; // a code segment selector in GDT or LDT
    56                                  ;   uint32_t zero;     // reserved
    57                                  ;   uint8_t type_attr; // type and attributes(Present,DPL,Storage_Segment,Gate type)
    58                                  ;   uint16_t offset_2; // offset bits 16..31
    59                                  ;--------------------------------------------------------------------------------------
    60                                  
    61                                  
    62                                  
    63                                  
    64                                  idt:
    65                                  
    66                                  ISR0 equ $-idt
    67 0000001E [0000]                     dw isr0_handler_DE
    68 00000020 1000                       dw cs_sel_32
    69 00000022 00                         db 0x0
    70 00000023 8E                         db 0x8E
    71 00000024 0000                       dw 0x0
    72                                     
    73                                  ISR1 equ $-idt
    74 00000026 0000000000000000           dq 0x0
    75                                  
    76                                  ISR2 equ $-idt
    77 0000002E [0000]                     dw isr2_handler_NMI
    78 00000030 1000                       dw cs_sel_32
    79 00000032 00                         db 0x0
    80 00000033 8F                         db 0x8F  
    81 00000034 0000                       dw 0x0
    82                                  
    83                                  ISR3 equ $-idt
    84 00000036 [0000]                     dw isr3_handler_BP
    85 00000038 1000                       dw cs_sel_32
    86 0000003A 00                         db 0x0
    87 0000003B 8F                         db 0x8F
    88 0000003C 0000                       dw 0x0
    89                                  
    90                                  ISR4 equ $-idt
    91 0000003E [0000]                     dw isr4_handler_OF
    92 00000040 1000                       dw cs_sel_32
    93 00000042 00                         db 0x0
    94 00000043 8F                         db 0x8F
    95 00000044 0000                       dw 0x0
    96                                  
    97                                  ISR5 equ $-idt
    98 00000046 [0000]                     dw isr5_handler_BR
    99 00000048 1000                       dw cs_sel_32
   100 0000004A 00                         db 0x0
   101 0000004B 8F                         db 0x8F
   102 0000004C 0000                       dw 0x0
   103                                  
   104                                  ISR6 equ $-idt
   105 0000004E [0000]                     dw isr6_handler_UD
   106 00000050 1000                       dw cs_sel_32
   107 00000052 00                         db 0x0
   108 00000053 8F                         db 0x8F
   109 00000054 0000                       dw 0x0
   110                                  
   111                                  ISR7 equ $-idt
   112 00000056 [0000]                     dw isr7_handler_NM
   113 00000058 1000                       dw cs_sel_32
   114 0000005A 00                         db 0x0
   115 0000005B 8F                         db 0x8F
   116 0000005C 0000                       dw 0x0
   117                                  
   118                                  ISR8 equ $-idt
   119 0000005E [0000]                     dw isr8_handler_DF
   120 00000060 1000                       dw cs_sel_32
   121 00000062 00                         db 0x0
   122 00000063 8F                         db 0x8F
   123 00000064 0000                       dw 0x0
   124                                  
   125                                  ISR9 equ $-idt
   126 00000066 [0000]                     dw isr9_handler
   127 00000068 1000                       dw cs_sel_32
   128 0000006A 00                         db 0x0
   129 0000006B 8F                         db 0x8F
   130 0000006C 0000                       dw 0x0
   131                                  
   132                                  ISR10 equ $-idt
   133 0000006E [0000]                     dw isr10_handler_TS
   134 00000070 1000                       dw cs_sel_32
   135 00000072 00                         db 0x0
   136 00000073 8F                         db 0x8F
   137 00000074 0000                       dw 0x0
   138                                  
   139                                  ISR11 equ $-idt
   140 00000076 [0000]                     dw isr11_handler_NP
   141 00000078 1000                       dw cs_sel_32
   142 0000007A 00                         db 0x0
   143 0000007B 8F                         db 0x8F
   144 0000007C 0000                       dw 0x0
   145                                  
   146                                  ISR12 equ $-idt
   147 0000007E [0000]                     dw isr12_handler_SS
   148 00000080 1000                       dw cs_sel_32
   149 00000082 00                         db 0x0
   150 00000083 8F                         db 0x8F
   151 00000084 0000                       dw 0x0
   152                                  
   153                                  ISR13 equ $-idt
   154 00000086 [0000]                     dw isr13_handler_GP
   155 00000088 1000                       dw cs_sel_32
   156 0000008A 00                         db 0x0
   157 0000008B 8F                         db 0x8F
   158 0000008C 0000                       dw 0x0
   159                                  
   160                                  ISR14 equ $-idt
   161 0000008E [0000]                     dw isr14_handler_PF
   162 00000090 1000                       dw cs_sel_32
   163 00000092 00                         db 0x0
   164 00000093 8F                         db 0x8F
   165 00000094 0000                       dw 0x0
   166                                  
   167                                  ISR15 equ $-idt
   168 00000096 0000000000000000           dq 0x0
   169                                  
   170                                  ISR16 equ $-idt
   171 0000009E [0000]                     dw isr16_handler_MF
   172 000000A0 1000                       dw cs_sel_32
   173 000000A2 00                         db 0x0
   174 000000A3 8F                         db 0x8F
   175 000000A4 0000                       dw 0x0
   176                                  
   177                                  ISR17 equ $-idt
   178 000000A6 [0000]                     dw isr17_handler_AC
   179 000000A8 1000                       dw cs_sel_32
   180 000000AA 00                         db 0x0
   181 000000AB 8F                         db 0x8F
   182 000000AC 0000                       dw 0x0
   183                                  
   184                                  ISR18 equ $-idt
   185 000000AE [0000]                     dw isr18_handler_MC
   186 000000B0 1000                       dw cs_sel_32
   187 000000B2 00                         db 0x0
   188 000000B3 8F                         db 0x8F
   189 000000B4 0000                       dw 0x0
   190                                  
   191                                  ISR19 equ $-idt
   192 000000B6 [0000]                     dw isr19_handler_XF
   193 000000B8 1000                       dw cs_sel_32
   194 000000BA 00                         db 0x0
   195 000000BB 8F                         db 0x8F
   196 000000BC 0000                       dw 0x0
   197                                  
   198                                  ISR20_31 equ $-idt
   199 000000BE 0000000000000000-         times 12 dq 0x0
   199 000000BE <rept>             
   200                                  
   201                                  ISR32 equ $-idt
   202 0000011E [0000]                     dw isr32_handler_PIT
   203 00000120 1000                       dw cs_sel_32
   204 00000122 00                         db 0x0
   205 00000123 8E                         db 0x8E
   206 00000124 0000                       dw 0x0
   207                                  
   208                                  ISR33 equ $-idt
   209 00000126 [0000]                     dw isr33_handler_KEYBOARD
   210 00000128 1000                       dw cs_sel_32
   211 0000012A 00                         db 0x0
   212 0000012B 8E                         db 0x8E
   213 0000012C 0000                       dw 0x0
   214                                  
   215                                  
   216                                  long_idt equ $-idt
   217                                  
   218                                  
   219                                  img_idtr:
   220 0000012E 0F01                          dw long_idt -1
   221 00000130 [1E000000]                    dd idt
   222                                  

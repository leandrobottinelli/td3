     1                                  
     2                                  GLOBAL MOSTRAR_PANTALLA
     3                                  EXTERN _NUMERO_TOTAL
     4                                  EXTERN _BUFFER_NUMERO_PANTALLA
     5                                  
     6                                  section .rutinas
     7                                  USE32
     8                                  
     9                                  BUFFER_VIDEO equ 0xb8000
    10                                  COLUMNAS equ 0x500
    11                                  
    12                                  
    13                                  %define ASCII_TECLA_A 0x41
    14                                  %define ASCII_TECLA_B 0x42
    15                                  %define ASCII_TECLA_C 0x43
    16                                  %define ASCII_TECLA_D 0x44
    17                                  %define ASCII_TECLA_E 0x45
    18                                  %define ASCII_TECLA_F 0x46
    19                                  %define ASCII_TECLA_0 0x30
    20                                  %define ASCII_TECLA_1 0x31
    21                                  %define ASCII_TECLA_2 0x32
    22                                  %define ASCII_TECLA_3 0x33
    23                                  %define ASCII_TECLA_4 0x34
    24                                  %define ASCII_TECLA_5 0x35
    25                                  %define ASCII_TECLA_6 0x36
    26                                  %define ASCII_TECLA_7 0x37
    27                                  %define ASCII_TECLA_8 0x38
    28                                  %define ASCII_TECLA_9 0x39
    29                                  %define ASCII_TECLA_x 0x78
    30                                  
    31                                  
    32                                  
    33                                      MOSTRAR_PANTALLA:
    34                                  
    35 00000000 B900000000                    mov ecx, 0x0 
    36 00000005 BA00000000                    mov edx, 0x0
    37 0000000A BB00000000                    mov ebx, 0x0
    38                                  
    39                                        PARTE_ALTA:
    40 0000000F A1[04000000]                  mov eax, [_NUMERO_TOTAL + 0x4]
    41 00000014 EB09                          jmp BUFFER
    42                                  
    43                                        PARTE_BAJA:
    44 00000016 A1[00000000]                  mov eax, [_NUMERO_TOTAL]
    45 0000001B 66BA0100                      mov dx, 0x01
    46                                        ;inc ecx ;me esta agregando espacio
    47                                  
    48                                   
    49                                  
    50                                  
    51                                  
    52                                        BUFFER:
    53 0000001F C1C004                        rol eax,0x4
    54 00000022 B30F                          mov bl,0xF
    55 00000024 21C3                          and ebx,eax
    56                                  
    57                                        L_0:
    58 00000026 80FB00                        cmp bl, 0x0
    59 00000029 B730                          mov bh, ASCII_TECLA_0 ; 
    60 0000002B 746A                          jz GUARDADO_LETRA
    61                                  
    62                                        L_1:
    63 0000002D 80FB01                          cmp bl, 0x1
    64 00000030 B731                            mov bh, ASCII_TECLA_1 ;  ; 
    65 00000032 7463                            jz GUARDADO_LETRA
    66                                  
    67                                        L_2:
    68 00000034 80FB02                          cmp bl, 0x2 ; 
    69 00000037 B732                            mov bh, ASCII_TECLA_2 ; 
    70 00000039 745C                            jz GUARDADO_LETRA
    71                                  
    72                                        L_3:
    73 0000003B 80FB03                          cmp bl, 0x3 ; 
    74 0000003E B733                            mov bh, ASCII_TECLA_3
    75 00000040 7455                            jz GUARDADO_LETRA   
    76                                  
    77                                        L_4:
    78 00000042 80FB04                          cmp bl, 0x4
    79 00000045 B734                            mov bh, ASCII_TECLA_4 ; 
    80 00000047 744E                            jz GUARDADO_LETRA 
    81                                  
    82                                        L_5:
    83 00000049 80FB05                          cmp bl, 0x5 ; 
    84 0000004C B735                            mov bh, ASCII_TECLA_5
    85 0000004E 7447                            jz GUARDADO_LETRA   
    86                                  
    87                                        L_6:
    88 00000050 80FB06                          cmp bl, 0x6
    89 00000053 B736                            mov bh, ASCII_TECLA_6 ; 
    90 00000055 7440                            jz GUARDADO_LETRA   
    91                                  
    92                                        L_7:
    93 00000057 80FB07                          cmp bl, 0x7 ; 
    94 0000005A B737                            mov bh, ASCII_TECLA_7
    95 0000005C 7439                            jz GUARDADO_LETRA     
    96                                        
    97                                        L_8:
    98 0000005E 80FB08                          cmp bl, 0x8
    99 00000061 B738                            mov bh, ASCII_TECLA_8 ; 
   100 00000063 7432                            jz GUARDADO_LETRA
   101                                        
   102                                        L_9:
   103 00000065 80FB09                          cmp bl, 0x9 
   104 00000068 B739                            mov bh, ASCII_TECLA_9 
   105 0000006A 742B                            jz GUARDADO_LETRA  
   106                                        
   107                                        L_A:
   108 0000006C 80FB0A                          cmp bl, 0xA 
   109 0000006F B741                            mov bh, ASCII_TECLA_A
   110 00000071 7424                            jz GUARDADO_LETRA
   111                                        
   112                                        L_B:
   113 00000073 80FB0B                          cmp bl, 0xB 
   114 00000076 B742                            mov bh, ASCII_TECLA_B 
   115 00000078 741D                            jz GUARDADO_LETRA  
   116                                        
   117                                        L_C:
   118 0000007A 80FB0C                          cmp bl, 0xC ; 
   119 0000007D B743                            mov bh, ASCII_TECLA_C
   120 0000007F 7416                            jz GUARDADO_LETRA 
   121                                        
   122                                        L_D:
   123 00000081 80FB0D                          cmp bl, 0xD 
   124 00000084 B744                            mov bh, ASCII_TECLA_D
   125 00000086 740F                            jz GUARDADO_LETRA 
   126                                        
   127                                        L_E:
   128 00000088 80FB0E                          cmp bl, 0xE 
   129 0000008B B745                            mov bh, ASCII_TECLA_E
   130 0000008D 7408                            jz GUARDADO_LETRA 
   131                                  
   132                                        L_F:
   133 0000008F 80FB0F                          cmp bl, 0xF 
   134 00000092 B746                            mov bh, ASCII_TECLA_F
   135 00000094 7401                            jz GUARDADO_LETRA 
   136                                  
   137 00000096 C3                            ret
   138                                  
   139                                        GUARDADO_LETRA:
   140                                   
   141                                     
   142                                  
   143                                  
   144 00000097 6683FA01                      cmp dx,0x1
   145 0000009B 7402                          jz AA
   146 0000009D EB07                          jmp BB
   147                                  
   148                                  
   149                                  
   150                                        AA:
   151 0000009F 83F910                        cmp ecx, 0x10
   152 000000A2 7417                          jz MOSTRAR_NUMERO
   153 000000A4 EB09                          jmp CC
   154                                  
   155                                        BB:
   156 000000A6 83F908                        cmp ecx, 0x8
   157 000000A9 0F8467FFFFFF                  jz PARTE_BAJA
   158                                  
   159                                        CC:
   160 000000AF 88B9[00000000]                mov byte[_BUFFER_NUMERO_PANTALLA + ecx],bh
   161 000000B5 41                            inc ecx
   162 000000B6 E964FFFFFF                    jmp BUFFER 
   163                                  
   164                                        MOSTRAR_NUMERO:
   165                                        
   166 000000BB B900000000                    mov ecx, 0x0
   167                                  
   168 000000C0 C60550850B0030                mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS], ASCII_TECLA_0
   169 000000C7 C60551850B0007                mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x01], 0x07
   170 000000CE C60552850B0078                mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x02], ASCII_TECLA_x
   171 000000D5 C60553850B0007                mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x03], 0x07
   172                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x04], ASCII_TECLA_0
   173                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x05], 0x07
   174                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x06], ASCII_TECLA_0
   175                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x07], 0x07
   176                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x08], ASCII_TECLA_0
   177                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x09], 0x07
   178                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x0A], ASCII_TECLA_0
   179                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x0B], 0x07
   180                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x0C], ASCII_TECLA_0
   181                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x0D], 0x07
   182                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x0E], ASCII_TECLA_0
   183                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x0F], 0x07
   184                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x10], ASCII_TECLA_0
   185                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x11], 0x07
   186                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x12], ASCII_TECLA_0
   187                                        ;mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x13], 0x07
   188                                  
   189                                        NUMERO:
   190 000000DC 8A81[00000000]                mov al , [_BUFFER_NUMERO_PANTALLA + ecx]  
   191 000000E2 88840954850B00                mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x04 +ecx*2], al  
   192 000000E9 C6840955850B0007              mov byte[BUFFER_VIDEO + 0x50 + COLUMNAS + 0x04 + ecx *2+ 0x01], 0x07
   193 000000F1 83F910                        cmp ecx,0x10
   194 000000F4 7403                          jz FIN
   195 000000F6 41                            inc ecx
   196 000000F7 EBE3                          jmp NUMERO
   197                                  
   198                                        FIN:
   199 000000F9 C3                            ret

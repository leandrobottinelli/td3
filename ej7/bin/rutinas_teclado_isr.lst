     1                                  GLOBAL isr0_handler_DE
     2                                  GLOBAL isr2_handler_NMI
     3                                  GLOBAL isr3_handler_BP
     4                                  GLOBAL isr4_handler_OF
     5                                  GLOBAL isr5_handler_BR
     6                                  GLOBAL isr6_handler_UD
     7                                  GLOBAL isr7_handler_NM
     8                                  GLOBAL isr8_handler_DF
     9                                  GLOBAL isr9_handler
    10                                  GLOBAL isr10_handler_TS
    11                                  GLOBAL isr11_handler_NP
    12                                  GLOBAL isr12_handler_SS
    13                                  GLOBAL isr13_handler_GP
    14                                  GLOBAL isr14_handler_PF
    15                                  GLOBAL isr15_handler
    16                                  GLOBAL isr16_handler_MF
    17                                  GLOBAL isr17_handler_AC
    18                                  GLOBAL isr18_handler_MC
    19                                  GLOBAL isr19_handler_XF
    20                                  GLOBAL isr32_handler
    21                                  GLOBAL isr33_handler
    22                                  
    23                                  
    24                                  
    25                                  ;GLOBAL POLLING
    26                                  GLOBAL LECTURA_TECLA
    27                                  EXTERN FIN
    28                                  EXTERN __INICIO_RAM_TECLADO_RUTINA
    29                                  EXTERN flag_int_teclado
    30                                  
    31                                  
    32                                  %define _PUERTO_TECLADO  0x64;
    33                                  %define _PUERTO_TECLADO_CODIGO 0x60;
    34                                  ;-------------------------------------------------------------------------------
    35                                  
    36                                  section .rutina_teclado_isr
    37                                  USE32
    38                                  
    39                                  POLLING:
    40                                  
    41 00000000 E464                    in al, _PUERTO_TECLADO 
    42 00000002 0FBAE000                bt eax, 0x00
    43 00000006 73F8                    jnc POLLING
    44                                  
    45                                  LECTURA_TECLA:
    46                                  
    47 00000008 E460                    in al, _PUERTO_TECLADO_CODIGO
    48 0000000A 660FBAE007              bt ax, 0x7
    49                                  
    50 0000000F 6687DB                  xchg bx,bx
    51 00000012 C3                      ret
    52                                  
    53                                  
    54                                  ;jmp CARGADO_TABLA
    55                                  
    56                                  
    57                                  ;CARGADO_TABLA:
    58                                  
    59                                  ;push ax
    60                                  ;call CARGAR_TABLA
    61                                  ;pop ax
    62                                  ;ret
    63                                  
    64                                  
    65                                  ;---------------------------------------------------------------------
    66                                  ; Handlers ISRs
    67                                  
    68                                  default_isr:
    69 00000013 90                         nop
    70 00000014 6687DB                     xchg bx,bx
    71 00000017 90                         nop
    72 00000018 F4                         hlt
    73                                  
    74                                  
    75                                  isr0_handler_DE:
    76 00000019 BA00000000                 mov edx, 0
    77 0000001E EBF3                       jmp default_isr
    78                                  
    79                                  
    80                                  isr2_handler_NMI:
    81 00000020 BA02000000                 mov edx, 2
    82 00000025 EBEC                       jmp default_isr
    83                                  
    84                                  
    85                                  isr3_handler_BP:
    86 00000027 BA03000000                 mov edx, 3
    87 0000002C EBE5                       jmp default_isr
    88                                  
    89                                  
    90                                  isr4_handler_OF:
    91 0000002E BA04000000                 mov edx, 4
    92 00000033 EBDE                       jmp default_isr
    93                                  
    94                                  
    95                                  isr5_handler_BR:
    96 00000035 BA05000000                 mov edx, 5
    97 0000003A EBD7                       jmp default_isr
    98                                  
    99                                  
   100                                  isr6_handler_UD:
   101 0000003C BA06000000                 mov edx, 6
   102 00000041 EBD0                       jmp default_isr
   103                                  
   104                                  
   105                                  isr7_handler_NM:
   106 00000043 BA07000000                 mov edx, 7
   107 00000048 EBC9                       jmp default_isr
   108                                  
   109                                  
   110                                  isr8_handler_DF:
   111 0000004A BA08000000                 mov edx, 8
   112 0000004F EBC2                       jmp default_isr
   113                                  
   114                                  isr9_handler:
   115 00000051 BA09000000                 mov edx, 9
   116 00000056 EBBB                       jmp default_isr
   117                                  
   118                                  
   119                                  isr10_handler_TS:
   120 00000058 BA0A000000                 mov edx, 10
   121 0000005D EBB4                       jmp default_isr
   122                                  
   123                                  
   124                                  isr11_handler_NP:
   125 0000005F BA0B000000                 mov edx, 11
   126 00000064 EBAD                       jmp default_isr
   127                                  
   128                                  
   129                                  isr12_handler_SS:
   130 00000066 BA0C000000                 mov edx, 12
   131 0000006B EBA6                       jmp default_isr
   132                                  
   133                                  
   134                                  isr13_handler_GP:
   135 0000006D BA0D000000                 mov edx, 13
   136 00000072 EB9F                       jmp default_isr
   137                                  
   138                                  
   139                                  isr14_handler_PF:
   140 00000074 BA0E000000                 mov edx, 14
   141 00000079 EB98                       jmp default_isr
   142                                  
   143                                  isr15_handler:
   144 0000007B BA0F000000                 mov edx, 15
   145 00000080 EB91                       jmp default_isr
   146                                  
   147                                  isr16_handler_MF:
   148 00000082 BA10000000                 mov edx, 16
   149 00000087 EB8A                       jmp default_isr
   150                                  
   151                                  
   152                                  isr17_handler_AC:
   153 00000089 BA11000000                 mov edx, 17
   154 0000008E EB83                       jmp default_isr
   155                                  
   156                                  
   157                                  isr18_handler_MC:
   158 00000090 BA12000000                 mov edx, 18
   159 00000095 E979FFFFFF                 jmp default_isr
   160                                  
   161                                  
   162                                  isr19_handler_XF:
   163 0000009A BA13000000                 mov edx, 19
   164 0000009F E96FFFFFFF                 jmp default_isr
   165                                  
   166                                  
   167                                  isr32_handler:
   168 000000A4 BA20000000                 mov edx, 32
   169 000000A9 E965FFFFFF                 jmp default_isr
   170                                  
   171                                  isr33_handler:
   172                                  
   173 000000AE 6687DB                     xchg bx,bx
   174 000000B1 60                         pushad
   175 000000B2 66B80100                   mov ax, 0x1
   176 000000B6 66A3[00000000]             mov [flag_int_teclado],ax
   177 000000BC B020                       mov al,0x20       ;Codigo para avisar al PIC que atendi la int 
   178 000000BE E620                       out 0x20,al
   179 000000C0 61                         popad
   180 000000C1 CF                         iret
   181                                  
   182                                  
   183                                  
   184                                  
   185                                  
   186                                  
   187                                  
   188                                  
   189                                  
   190                                  
   191                                  
   192                                  
   193                                  
   194                                  
   195                                  
   196                                  
   197                                  
   198                                  
   199                                  
   200                                  
   201                                  
   202                                  

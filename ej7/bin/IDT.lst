     1                                  
     2                                  
     3                                  GLOBAL img_gdtr
     4                                  GLOBAL img_idtr
     5                                  
     6                                  GLOBAL cs_sel
     7                                  GLOBAL ds_sel
     8                                  
     9                                  
    10                                  EXTERN isr0_handler_DE
    11                                  EXTERN isr1_handler_DB
    12                                  EXTERN isr2_handler_NMI
    13                                  EXTERN isr3_handler_BP
    14                                  EXTERN isr4_handler_OF
    15                                  EXTERN isr5_handler_BR
    16                                  EXTERN isr6_handler_UD
    17                                  EXTERN isr7_handler_NM
    18                                  EXTERN isr8_handler_DF
    19                                  EXTERN isr9_handler
    20                                  EXTERN isr10_handler_TS
    21                                  EXTERN isr11_handler_NP
    22                                  EXTERN isr12_handler_SS
    23                                  EXTERN isr13_handler_GP
    24                                  EXTERN isr14_handler_PF
    25                                  EXTERN isr15_handler
    26                                  EXTERN isr16_handler_MF
    27                                  EXTERN isr17_handler_AC
    28                                  EXTERN isr18_handler_MC
    29                                  EXTERN isr19_handler_XF
    30                                  EXTERN isr20_31_handler
    31                                  
    32                                  
    33                                  
    34                                  section .sys_tables progbits alloc
    35                                  USE16
    36                                  gdt:
    37 00000000 0000000000000000                  db 0,0,0,0,0,0,0,0  ;Descriptor nulo
    38                                  ds_sel    equ $-gdt
    39 00000008 FFFF00000092CF00                  db 0xFF, 0xFF, 0, 0, 0, 0x92, 0xCF, 0
    40                                  cs_sel    equ $-gdt
    41 00000010 FFFF0000009ACF00                  db 0xFF, 0xFF, 0, 0, 0, 0x9A, 0xCF, 0
    42                                  
    43                                  long_gdt equ $-gdt
    44                                  
    45                                  
    46                                  img_gdtr:
    47 00000018 1700                        dw long_gdt-1
    48 0000001A [00000000]                  dd gdt
    49                                  
    50                                  
    51                                  
    52                                  
    53                                  
    54                                  
    55                                  
    56                                  ;--------------------------------------------------------------------------------------
    57                                  ;   uint16_t offset_1; // offset bits 0..15
    58                                  ;   uint16_t selector; // a code segment selector in GDT or LDT
    59                                  ;   uint32_t zero;     // reserved
    60                                  ;   uint8_t type_attr; // type and attributes(Present,DPL,Storage_Segment,Gate type)
    61                                  ;   uint16_t offset_2; // offset bits 16..31
    62                                  ;--------------------------------------------------------------------------------------
    63                                  
    64                                  
    65                                  
    66                                  
    67                                  idt:
    68                                  
    69                                  ISR0 equ $-idt
    70 0000001E [0000]                     dw isr0_handler_DE
    71 00000020 1000                       dw cs_sel
    72 00000022 00                         db 0x0
    73 00000023 8E                         db 0x8E
    74 00000024 0000                       dw 0x0
    75                                     
    76                                  ISR1 equ $-idt
    77 00000026 [0000]                     dw isr1_handler_DB
    78 00000028 1000                       dw cs_sel
    79 0000002A 00                         db 0x0
    80 0000002B 8E                         db 0x8E
    81 0000002C 0000                       dw 0x0
    82                                  
    83                                  ISR2 equ $-idt
    84 0000002E [0000]                     dw isr2_handler_NMI
    85 00000030 1000                       dw cs_sel
    86 00000032 00                         db 0x0
    87 00000033 8E                         db 0x8E  
    88 00000034 0000                       dw 0x0
    89                                  
    90                                  ISR3 equ $-idt
    91 00000036 [0000]                     dw isr3_handler_BP
    92 00000038 1000                       dw cs_sel
    93 0000003A 00                         db 0x0
    94 0000003B 8E                         db 0x8E
    95 0000003C 0000                       dw 0x0
    96                                  
    97                                  ISR4 equ $-idt
    98 0000003E [0000]                     dw isr4_handler_OF
    99 00000040 1000                       dw cs_sel
   100 00000042 00                         db 0x0
   101 00000043 8E                         db 0x8E
   102 00000044 0000                       dw 0x0
   103                                  
   104                                  ISR5 equ $-idt
   105 00000046 [0000]                     dw isr5_handler_BR
   106 00000048 1000                       dw cs_sel
   107 0000004A 00                         db 0x0
   108 0000004B 8E                         db 0x8E
   109 0000004C 0000                       dw 0x0
   110                                  
   111                                  ISR6 equ $-idt
   112 0000004E [0000]                     dw isr6_handler_UD
   113 00000050 1000                       dw cs_sel
   114 00000052 00                         db 0x0
   115 00000053 8E                         db 0x8E
   116 00000054 0000                       dw 0x0
   117                                  
   118                                  ISR7 equ $-idt
   119 00000056 [0000]                     dw isr7_handler_NM
   120 00000058 1000                       dw cs_sel
   121 0000005A 00                         db 0x0
   122 0000005B 8E                         db 0x8E
   123 0000005C 0000                       dw 0x0
   124                                  
   125                                  ISR8 equ $-idt
   126 0000005E [0000]                     dw isr8_handler_DF
   127 00000060 1000                       dw cs_sel
   128 00000062 00                         db 0x0
   129 00000063 8E                         db 0x8E
   130 00000064 0000                       dw 0x0
   131                                  
   132                                  ISR9 equ $-idt
   133 00000066 [0000]                     dw isr9_handler
   134 00000068 1000                       dw cs_sel
   135 0000006A 00                         db 0x0
   136 0000006B 8E                         db 0x8E
   137 0000006C 0000                       dw 0x0
   138                                  
   139                                  ISR10 equ $-idt
   140 0000006E [0000]                     dw isr10_handler_TS
   141 00000070 1000                       dw cs_sel
   142 00000072 00                         db 0x0
   143 00000073 8E                         db 0x8E
   144 00000074 0000                       dw 0x0
   145                                  
   146                                  ISR11 equ $-idt
   147 00000076 [0000]                     dw isr11_handler_NP
   148 00000078 1000                       dw cs_sel
   149 0000007A 00                         db 0x0
   150 0000007B 8E                         db 0x8E
   151 0000007C 0000                       dw 0x0
   152                                  
   153                                  ISR12 equ $-idt
   154 0000007E [0000]                     dw isr12_handler_SS
   155 00000080 1000                       dw cs_sel
   156 00000082 00                         db 0x0
   157 00000083 8E                         db 0x8E
   158 00000084 0000                       dw 0x0
   159                                  
   160                                  ISR13 equ $-idt
   161 00000086 [0000]                     dw isr13_handler_GP
   162 00000088 1000                       dw cs_sel
   163 0000008A 00                         db 0x0
   164 0000008B 8E                         db 0x8E
   165 0000008C 0000                       dw 0x0
   166                                  
   167                                  ISR14 equ $-idt
   168 0000008E [0000]                     dw isr14_handler_PF
   169 00000090 1000                       dw cs_sel
   170 00000092 00                         db 0x0
   171 00000093 8E                         db 0x8E
   172 00000094 0000                       dw 0x0
   173                                  
   174                                  ISR15 equ $-idt
   175 00000096 [0000]                     dw isr15_handler
   176 00000098 1000                       dw cs_sel
   177 0000009A 00                         db 0x0
   178 0000009B 8E                         db 0x8E
   179 0000009C 0000                       dw 0x0
   180                                  
   181                                  ISR16 equ $-idt
   182 0000009E [0000]                     dw isr16_handler_MF
   183 000000A0 1000                       dw cs_sel
   184 000000A2 00                         db 0x0
   185 000000A3 8E                         db 0x8E
   186 000000A4 0000                       dw 0x0
   187                                  
   188                                  ISR17 equ $-idt
   189 000000A6 [0000]                     dw isr17_handler_AC
   190 000000A8 1000                       dw cs_sel
   191 000000AA 00                         db 0x0
   192 000000AB 8E                         db 0x8E
   193 000000AC 0000                       dw 0x0
   194                                  
   195                                  ISR18 equ $-idt
   196 000000AE [0000]                     dw isr18_handler_MC
   197 000000B0 1000                       dw cs_sel
   198 000000B2 00                         db 0x0
   199 000000B3 8E                         db 0x8E
   200 000000B4 0000                       dw 0x0
   201                                  
   202                                  ISR19 equ $-idt
   203 000000B6 [0000]                     dw isr19_handler_XF
   204 000000B8 1000                       dw cs_sel
   205 000000BA 00                         db 0x0
   206 000000BB 8E                         db 0x8E
   207 000000BC 0000                       dw 0x0
   208                                  
   209                                  ISR20_31 equ $-idt
   210 000000BE [0000]                     dw isr20_31_handler
   211 000000C0 1000                       dw cs_sel
   212 000000C2 00                         db 0x0
   213 000000C3 8E                         db 0x8E
   214 000000C4 0000                       dw 0x0
   215                                  
   216                                  
   217                                  long_idt equ $-idt
   218                                  
   219                                  
   220                                  img_idtr:
   221 000000C6 A700                          dw long_idt -1
   222 000000C8 [1E000000]                    dd idt
   223                                  
